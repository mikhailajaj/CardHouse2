<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="format-detection" content="telephone=no">


    <meta name="viewport" content="width=device-width, minimum-scale=1, maximum-scale=1" />    <meta name="msapplication-tap-highlight" content="no">

    <link rel="icon" href="data:;base64,iVBORw0KGgo=">
    <link rel="stylesheet" type="text/css" href="../css/index.css">


    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.0/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-PDle/QlgIONtM1aqA2Qemk5gPOE7wFq8+Em+G/hmo5Iq0CCmYZLv3fVRDJ4MMwEA" crossorigin="anonymous">


    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.0/js/bootstrap.min.js" integrity="sha384-7aThvCh9TypR7fIc2HV4O/nFMVCBwyIUKL8XCtKE+8xgCgl/PQGuFsvShjr74PBp" crossorigin="anonymous"></script>

    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.1/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">

</head>
<body>
<div id="divPlayer1"></div>
<script>


    var jqmReady =$.Deferred();
    var cordovaReady = $.Deferred();
    $(document).on("pagecreate",jqmReady.resolve);
    window.addEventListener("deviceReady",cordovaReady.resolve);
    $.when(jqmReady,cordovaReady).then(initApp);
    function initApp(){
        cards = cards.intiCards();
        initPlayers(cards.cardList);
    }

    var playerNumber= 1;




    // creating the card deck
    var cards= {
        cardList: [],
        SUITS :["spade", "heart", "diamond", "club"],

        intiCards: function() {
            for (var i = 1; i < 53; i++) {
                var card = {
                    value: i,
                    svgLink: "/img/cards/" + this.value + ".svg",
                    suit: this.SUITS[Math.floor(this.value / 13)]
                };
                //console.log(newCard.svgLink);
                this.cardList[i] = card;
            }
        }
    };

    function Card(number){
        this.SUITS =["spade", "heart", "diamond", "club"];
        this.value = number % 13;
        //suit should be
        this.suit = SUITS[Math.floor(number/13)];
        this.imgPath = '<li><img  src="../img/cards/'+ number+'.png"></li>';
    }

    var cardsDeck = cards.intiCards();


    // creating the card object
    function initPlayers(deck) {
        var player1 = player.cardList(deck);
        var player2 = player.cardList(deck);
        var player3 = player.cardList(deck);
        var player4 = player.cardList(deck);


        player1.next = player2;
        player2.next = player3;
        player3.next = player4;
        player4.next = player1;
        return [player1,player2,player3,player4]
    }

    player={
        cardList:generateHandCards13(cardsDeck),
        suitCallPlayer:suitCall(),
        suitCallComputer:0,
        profilePath:"www/img/logo.png",
        playerName:"computer"+this.playerNumber,
        playerNumber:playerNumber++,
        AiPlayer:true,
        played:false,
        playerScore:0,
        playerNext:null,
        playCard:function () {
            if(this.AiPlayer === false){

            }else{

            }
        },
        callBitIn:true,
        callTarneeb:callTarneeb()
    };

    function callTarneeb() {
        $("suits-option").show(slow).on("click",function (ev) {
            var self = $(this);
            var suitCalled = self.val();
            self.parent().hide("fast");
            return suitCalled;
        })
    }

    function generateHandCards13(deck){

        //give 13 card to each player
        var cardValue;
        var cards = [];
        for(var i = 0; i< 13;i++){
            console.log(deck);
            cardValue = getRandomInt(deck.length);
            //check if the card has two instant
            cards[i]=deck[cardValue].pop();
        }
        return cards;
    }

    function getRandomInt(max ) {

        return Math.floor((Math.random() * Math.floor(max)) +1);
    }

    function suitCall() {
        console.log("suitCall is fired from playerObj function");
        var bitObject = $("#bit-object");
        bitObject.on("click", function (e) {
            return $(this).val()&& $(this).parent().hide("fast");
        });
    }

    function roundControl(listOfFourCards,primarySuit) {
        var winner = new Card(0);
        for(var i = 0;i<listOfFourCards.length;i++){
            if(listOfFourCards[i].suit === primarySuit && winner.suit !== primarySuit ){
                winner = listOfFourCards[i];
            }
            if(listOfFourCards[i].suit === primarySuit && winner.suit === primarySuit ) {
                if (winner.value > listOfFourCards[i].value) {
                    winner = listOfFourCards[i];
                }
            }
            if(winner.value < listOfFourCards[i].value && winner.suit !== primarySuit){
                winner = listOfFourCards[i]
            }

        }
        return winner;
    }

    var game = {
        initGame:game(this.players),
        players:initPlayers(this.Deck),
        Deck:cardDeck(),
        gameRule1:function (score) {
            while (score < 31){
                this.noWinner = true
                return;
            } ;
            this.noWinner = false;
        },
        tarneebSuit:"",
        gameRule2:roundControl(this.cardsPlayed,this.tarneebSuit),
        noWinner:true,
        roundWinner:null,
        //cardsPlayed is $ * (player, value, suit)
        cardsPlayed:[],

    };
    function roundControl(listOfFourCards,primarySuit) {
        var winner = new Card(0);
        for(var i = 0;i<listOfFourCards.length;i++){
            if(listOfFourCards[i].suit === primarySuit && winner.suit !== primarySuit ){
                winner = listOfFourCards[i];
            }
            if(listOfFourCards[i].suit === primarySuit && winner.suit === primarySuit ) {
                if (winner.value > listOfFourCards[i].value) {
                    winner = listOfFourCards[i];
                }
            }
            if(winner.value < listOfFourCards[i].value && winner.suit !== primarySuit){
                winner = listOfFourCards[i]
            }

        }
        return winner;
    }
    var cardTurn = [];
    function test() {
        console.log("test runs");
        var deck = cardDeck();
        var $divPlayer1 = $("#divPlayer1");
        playerObj(deck,$divPlayer1);


        //var $player2 = $("#player1");

        var $player1 = $("#player1");
        // I stopped here TO-DO
        $player1.on("click","li",function () {
            var self = $(this);
            cardTurn.push(self);
        });

        var baraja = $player1.baraja();
        console.log(baraja);
        $("#fan-close").on("click",function (ev) {
            if(baraja.isClosed()){
                baraja.fan();
            }else {
                baraja.close();
            }
        });
        console.log();


        //$player1.text("please do something");
    }
    test();


    //pass cardTurn
    function game(players) {

        var score1 = players[0].score +players[2].score;
        var score2 = players[1].score +players[3].score;
        while (score1 < 41 || score2 < 41){
            var player = players[0];
            var suitCall = [0,7,8,9,10,11,12,13];
            //calling the the highest cards
            var call=0;
            while (player.callBitIn){
                // 7 should be the input from the user
                var tmp = parseInt(player.suitCall());
                if (tmp){
                    console.log("tmp is not a number pass is clicked");
                    tmp = 0;
                    player.callBitIn = false;
                }

                //disable the button that is clicked or the one that is not

                //TO-Do make the pc not bit
                if(player.next().callBitIn){
                    player = player.next();
                }
            }
            //this player has the highest bit
            player.primarySuit();
            for (var i = 0; i < 13; i++) {
                var playedCard = [];
                //RoundWinner is number of the player
                for(var j = 0;j<4;j++){
                    //throw card from each player collection of four

                    //here the player can play any thing
                    //allow the user to play any thing
                    var card = player.playCard();
                    player.played = true;
                    player = player.next;

                    playedCard.push(card)
                }
                var RoundWinner = roundControl(listOfFourCards,primarySuit);

                //user interface for this user should increase by 1
                //we to assign the player to first cardplayed
                //here should be the condition if other player has the same suit
            }
        }

    };

    function cardDeck() {
        var deck=[];
        for(var i = 0;i<52;i++){
            //i object which is card
            var card = new Card(i);
            deck.push(card);
        }
        return deck;
    }

    function Card(number){
        this.value = number % 13;
        //suit should be
        this.suit = SUITS[Math.floor(number/13)];
        this.imgPath = '<li><img  src="../img/cards/'+ number+'.png"></li>';
    }

    function playerObj(deck){
        console.log("player is created ");
        this.cardsList = [];
        var $ul = $("<ul id=\"player"+playerNumber++ +"\" class=\"baraja-container\"></ul>");
        var txt = '';
        for (var i = 0; i < 13;i++){
            this.cardsList.push(deck.pop());
            txt += this.cardsList[i].imgPath;

            //console.log(this.cardsList[i].imgPath);
        }
        console.log(txt);
        this.suitCall = (function () {
            console.log("suitCall is fired from playerObj function");
            var bitObject = $("#bit-object");
            bitObject.on("click", function (e) {
                return $(this).val()&& $(this).parent().hide("fast");
            });
        });
        var jQueryObjListOfCards = $ul.html(txt);
        $place.append(jQueryObjListOfCards);
        this.profileImgPath = "<img  src = \"../img/logo.png\">";
        this.playerName = "computer";
        this.played = false;
        this.playerScore = 0;
        this.next = null;
        this.playCard = function () {
            var $obj = this.getJQueryObj;
            var list = this.cardsList;
            $obj.on("click","img",function(list){
                var $imgAtrr = $(this).attr("src");
                var i = 0;
                for(;i< list.length;i++){
                    if(list[i].imgPath === $imgAtrr){
                        break;
                    }
                }
                $(this).hide();
                return list[i];
            });
        };
        this.callBitIn = true;
        this.primarySuit = (function () {
            var suitsOption = $("#suits-option");
            suitsOption.on("click", "a", function (e) {
                return $(this).text();

            });
        });

    }



</script>
<script type="text/javascript" src="../js/jquery.baraja.js"></script>

<script type="text/javascript" src="../js/index.js"></script>
</body>
</html>